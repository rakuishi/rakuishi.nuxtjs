{
  "categories": [
    "iOS"
  ],
  "date": "2012-03-07T10:37:56.000Z",
  "draft": false,
  "slug": 2831,
  "title": "[iOS SDK] Core Data で、デフォルトデータを読み込ませる方法",
  "bodyContent": "CoreData で、用意したデフォルトデータを初回起動時に読み込ませたかったので、その方法をまとめてみました。\n\n環境：Xcode 4.2.1, iPhone 5.0 Simulator\n\n## デフォルトデータの作成\n\nデフォルトデータを作成するために、「Master-Detail Application」で新規プロジェクトを作成します（「Use Core Data」にチェックが入っていることを確認します）。\n\nこのサンプルプログラムは、右上のプラスボタンを押すたびに、現在の日時を格納します。ここでは、iOS Simulator で実行して、プラスボタンを連打してデフォルトデータを作成します。\n\n## デフォルトデータの所在\n\n作成したデータは、以下のアドレスにあります。\n\n/Users/ユーザ名/Library/Application Support/iPhone Simulator/バージョン名/Applications/アプリ名/Documents/アプリ名.sqlite\n\nこれをプロジェクトの「Supporting Files」などに入れておきます。ドラッグ＆ドロップして入れた場合は、「Copy items into destination group's folder」、「Add to targets」にチェックを入れて、ファイルをコピーしておきます。\n\n![](/images/2012/03/2831_1.png)\n\n## データをコピーするようにコードを修正\n\nAppDelegate.m の persistentStoreCoordinator() というメソッドで、データをロードしていますので、ここを変えてあげます。\n\n変更前。コメントは省いています。\n\n```\n- (NSPersistentStoreCoordinator *)persistentStoreCoordinator\n{\n    if (__persistentStoreCoordinator != nil)\n    {\n        return __persistentStoreCoordinator;\n    }\n    \n    NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@\"Hoge.sqlite\"];\n    \n    NSError *error = nil;\n    __persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];\n    if (![__persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;error])\n    {\n        NSLog(@\"Unresolved error %@, %@\", error, [error userInfo]);\n        abort();\n    }    \n    \n    return __persistentStoreCoordinator;\n}\n```\n\n一旦、iOS Simulator からアプリを削除して、用意したデータを読み込ませるように書き換えます。\n\n変更後。\n\n```\n- (NSPersistentStoreCoordinator *)persistentStoreCoordinator\n{\n    if (__persistentStoreCoordinator != nil)\n    {\n        return __persistentStoreCoordinator;\n    }\n        \n    NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);\n    NSString *documentsDirectory = [paths objectAtIndex:0];\n    NSString *writableDBPath = [documentsDirectory stringByAppendingPathComponent:@\"Hoge.sqlite\"];\n    \n    NSString *storePath = [[NSBundle mainBundle] pathForResource:@\"Hoge\" ofType:@\"sqlite\"];\n    \n    \n    NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@\"Hoge.sqlite\"]; \n    \n    NSLog(@\"store URL %@\", storeURL);\n    \n    NSFileManager *fileManager = [NSFileManager defaultManager];\n    if (![fileManager fileExistsAtPath:writableDBPath]) {\n        NSString *defaultStorePath = [[NSBundle mainBundle] pathForResource:@\"Hoge\" ofType:@\"sqlite\"];\n                \n        if (defaultStorePath) {\n            [fileManager copyItemAtPath:defaultStorePath toPath:writableDBPath error:NULL];\n            NSLog(@\"storePath= %@\", storePath);\n        }\n    }    \n    \n    NSError *error = nil;\n    __persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];\n    if (![__persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;error]) {\n        \n        NSLog(@\"Unresolved error %@, %@\", error, [error userInfo]);\n        abort();\n    }    \n    \n    return __persistentStoreCoordinator;\n}\n```\n\nこれで起動すると、アプリ起動時にデフォルトデータが読み込まれていると思います。\n\n![](/images/2012/03/2831_2.png)\n\n## 参考\n\n* [kshimizの日誌: Core Data デフォルトのデータを用意する](http://blog.prunus.jp/2010/06/core-data.html)\n* [iphone - importing sqlite to coredata - Stack Overflow](http://stackoverflow.com/questions/5002250/importing-sqlite-to-coredata)",
  "bodyHtml": "<p>CoreData で、用意したデフォルトデータを初回起動時に読み込ませたかったので、その方法をまとめてみました。</p>\n<p>環境：Xcode 4.2.1, iPhone 5.0 Simulator</p>\n<h2>デフォルトデータの作成</h2>\n<p>デフォルトデータを作成するために、「Master-Detail Application」で新規プロジェクトを作成します（「Use Core Data」にチェックが入っていることを確認します）。</p>\n<p>このサンプルプログラムは、右上のプラスボタンを押すたびに、現在の日時を格納します。ここでは、iOS Simulator で実行して、プラスボタンを連打してデフォルトデータを作成します。</p>\n<h2>デフォルトデータの所在</h2>\n<p>作成したデータは、以下のアドレスにあります。</p>\n<p>/Users/ユーザ名/Library/Application Support/iPhone Simulator/バージョン名/Applications/アプリ名/Documents/アプリ名.sqlite</p>\n<p>これをプロジェクトの「Supporting Files」などに入れておきます。ドラッグ＆ドロップして入れた場合は、「Copy items into destination group's folder」、「Add to targets」にチェックを入れて、ファイルをコピーしておきます。</p>\n<p><img src=\"/images/2012/03/2831_1.png\" alt=\"\"></p>\n<h2>データをコピーするようにコードを修正</h2>\n<p>AppDelegate.m の persistentStoreCoordinator() というメソッドで、データをロードしていますので、ここを変えてあげます。</p>\n<p>変更前。コメントは省いています。</p>\n<pre><code>- (NSPersistentStoreCoordinator *)persistentStoreCoordinator\n{\n    if (__persistentStoreCoordinator != nil)\n    {\n        return __persistentStoreCoordinator;\n    }\n    \n    NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@&quot;Hoge.sqlite&quot;];\n    \n    NSError *error = nil;\n    __persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];\n    if (![__persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;amp;error])\n    {\n        NSLog(@&quot;Unresolved error %@, %@&quot;, error, [error userInfo]);\n        abort();\n    }    \n    \n    return __persistentStoreCoordinator;\n}\n</code></pre>\n<p>一旦、iOS Simulator からアプリを削除して、用意したデータを読み込ませるように書き換えます。</p>\n<p>変更後。</p>\n<pre><code>- (NSPersistentStoreCoordinator *)persistentStoreCoordinator\n{\n    if (__persistentStoreCoordinator != nil)\n    {\n        return __persistentStoreCoordinator;\n    }\n        \n    NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);\n    NSString *documentsDirectory = [paths objectAtIndex:0];\n    NSString *writableDBPath = [documentsDirectory stringByAppendingPathComponent:@&quot;Hoge.sqlite&quot;];\n    \n    NSString *storePath = [[NSBundle mainBundle] pathForResource:@&quot;Hoge&quot; ofType:@&quot;sqlite&quot;];\n    \n    \n    NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@&quot;Hoge.sqlite&quot;]; \n    \n    NSLog(@&quot;store URL %@&quot;, storeURL);\n    \n    NSFileManager *fileManager = [NSFileManager defaultManager];\n    if (![fileManager fileExistsAtPath:writableDBPath]) {\n        NSString *defaultStorePath = [[NSBundle mainBundle] pathForResource:@&quot;Hoge&quot; ofType:@&quot;sqlite&quot;];\n                \n        if (defaultStorePath) {\n            [fileManager copyItemAtPath:defaultStorePath toPath:writableDBPath error:NULL];\n            NSLog(@&quot;storePath= %@&quot;, storePath);\n        }\n    }    \n    \n    NSError *error = nil;\n    __persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];\n    if (![__persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;amp;error]) {\n        \n        NSLog(@&quot;Unresolved error %@, %@&quot;, error, [error userInfo]);\n        abort();\n    }    \n    \n    return __persistentStoreCoordinator;\n}\n</code></pre>\n<p>これで起動すると、アプリ起動時にデフォルトデータが読み込まれていると思います。</p>\n<p><img src=\"/images/2012/03/2831_2.png\" alt=\"\"></p>\n<h2>参考</h2>\n<ul>\n<li><a href=\"http://blog.prunus.jp/2010/06/core-data.html\">kshimizの日誌: Core Data デフォルトのデータを用意する</a></li>\n<li><a href=\"http://stackoverflow.com/questions/5002250/importing-sqlite-to-coredata\">iphone - importing sqlite to coredata - Stack Overflow</a></li>\n</ul>\n",
  "dir": "static/content/archives",
  "base": "2012-03-07-2831.json",
  "ext": ".json",
  "sourceBase": "2012-03-07-2831.md",
  "sourceExt": ".md"
}