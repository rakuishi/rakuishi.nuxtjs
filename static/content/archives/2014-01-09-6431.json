{
  "categories": [
    "JavaScript"
  ],
  "date": "2014-01-09T14:00:38.000Z",
  "draft": false,
  "slug": 6431,
  "title": "[JavaScript] jQuery を使わずにスクロールでトップに戻るボタンを表示する",
  "bodyContent": "ページを下にスクロールすると右下に「トップに戻る」ボタンが表示され、タップするとページ上部に戻るあれを JavaScript で書いてみました。\n\njQuery で実装されているのはそこらへんに転がっていますが、jQuery は勉強してないから分からないし、ライブラリ（100KB 程度）を読み込むリクエストが発生するからという理由で JavaScript だけで書いてみました。\n\n![](/images/2014/01/6431_1.png)\n\nここからは、実装する上で使用したコードを解説していきます。\n\n## JavaScript：ページ上部にスクロールする\n\nページ上部にスクロールする JavaScript です。参考ページのコードをそのまま使用させて頂きました。\n\n参考：[「ページの先頭に戻る」をスムーズに移動させるJs](http://affiliatop.sitefix.jp/blog/js.html)\n\n```\nfunction scrollToTop() {\n  var x1 = x2 = x3 = 0;\n  var y1 = y2 = y3 = 0;\n  if (document.documentElement) {\n    x1 = document.documentElement.scrollLeft || 0;\n    y1 = document.documentElement.scrollTop || 0;\n  }\n  if (document.body) {\n    x2 = document.body.scrollLeft || 0;\n    y2 = document.body.scrollTop || 0;\n  }\n  x3 = window.scrollX || 0;\n  y3 = window.scrollY || 0;\n  var x = Math.max(x1, Math.max(x2, x3));\n  var y = Math.max(y1, Math.max(y2, y3));\n  window.scrollTo(Math.floor(x / 2), Math.floor(y / 2));\n  if (x > 0 || y > 0) {\n    window.setTimeout(\"scrollToTop()\", 30);\n  }\n}\n```\n\nこの関数を `a` タグの `onclick` から呼び出します。\n\n```\n<a href=\"\" onclick=\"scrollToTop(); return false\">トップに戻る</a>\n```\n\n## JavaScript：現在のページ位置に応じてボタンを表示／非表示する\n\n要素のスクロール時に処理を行うように `onscroll` を使用します。`onscroll` に指定した関数の中で現在の位置と、全体の位置を計算しています。\n\nスクロール位置が全体の 10% 以上にある場合は、トップに戻るボタンに割り当てた、ボタンを非表示にするクラス `scroll-to-top-not-display` を取り除く処理を走らせています。\n\n```\nvar element = null;\nwindow.onscroll = function() {\n    var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;\n    var scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;\n    if (element == null) {\n      element = document.getElementById('scroll-to-top');\n    }\n    if (scrollTop / scrollHeight > 0.1) {\n      element.classList.remove('scroll-to-top-not-display');\n    } else {\n      element.classList.add('scroll-to-top-not-display');\n    }\n}\n```\n\nまた、ページを読み込んだ時点ではボタンを表示させないように、`scroll-to-top-not-displayed` クラスは最初から記述します。\n\n```\n<a href=\"\" onclick=\"scrollToTop(); return false\" id=\"scroll-to-top\" class=\"scroll-to-top-not-display\">トップに戻る</a>\n```\n\n## CSS：常に前面にボタンを表示させる\n\n`position` を固定 `fixed` し、位置を指定 `bottom, right` し、`z-index` を最大値 2147483647 に設定します。そうすれば、スクロールしても位置が変わらないボタンが作成出来ます。\n\n```\n#scroll-to-top {\n  position: fixed;\n  z-index: 2147483647;\n  bottom: 20px;\n  right: 20px;\n  background: rgba(0,0,0,0.75);\n  color: #fff;\n  font-size: 12px;\n  font-family: sans-serif;\n  text-decoration: none;\n  padding: 10px 10px;\n  border-radius: 2px;\n}\n```",
  "bodyHtml": "<p>ページを下にスクロールすると右下に「トップに戻る」ボタンが表示され、タップするとページ上部に戻るあれを JavaScript で書いてみました。</p>\n<p>jQuery で実装されているのはそこらへんに転がっていますが、jQuery は勉強してないから分からないし、ライブラリ（100KB 程度）を読み込むリクエストが発生するからという理由で JavaScript だけで書いてみました。</p>\n<p><img src=\"/images/2014/01/6431_1.png\" alt=\"\"></p>\n<p>ここからは、実装する上で使用したコードを解説していきます。</p>\n<h2>JavaScript：ページ上部にスクロールする</h2>\n<p>ページ上部にスクロールする JavaScript です。参考ページのコードをそのまま使用させて頂きました。</p>\n<p>参考：<a href=\"http://affiliatop.sitefix.jp/blog/js.html\">「ページの先頭に戻る」をスムーズに移動させるJs</a></p>\n<pre><code>function scrollToTop() {\n  var x1 = x2 = x3 = 0;\n  var y1 = y2 = y3 = 0;\n  if (document.documentElement) {\n    x1 = document.documentElement.scrollLeft || 0;\n    y1 = document.documentElement.scrollTop || 0;\n  }\n  if (document.body) {\n    x2 = document.body.scrollLeft || 0;\n    y2 = document.body.scrollTop || 0;\n  }\n  x3 = window.scrollX || 0;\n  y3 = window.scrollY || 0;\n  var x = Math.max(x1, Math.max(x2, x3));\n  var y = Math.max(y1, Math.max(y2, y3));\n  window.scrollTo(Math.floor(x / 2), Math.floor(y / 2));\n  if (x &gt; 0 || y &gt; 0) {\n    window.setTimeout(&quot;scrollToTop()&quot;, 30);\n  }\n}\n</code></pre>\n<p>この関数を <code>a</code> タグの <code>onclick</code> から呼び出します。</p>\n<pre><code>&lt;a href=&quot;&quot; onclick=&quot;scrollToTop(); return false&quot;&gt;トップに戻る&lt;/a&gt;\n</code></pre>\n<h2>JavaScript：現在のページ位置に応じてボタンを表示／非表示する</h2>\n<p>要素のスクロール時に処理を行うように <code>onscroll</code> を使用します。<code>onscroll</code> に指定した関数の中で現在の位置と、全体の位置を計算しています。</p>\n<p>スクロール位置が全体の 10% 以上にある場合は、トップに戻るボタンに割り当てた、ボタンを非表示にするクラス <code>scroll-to-top-not-display</code> を取り除く処理を走らせています。</p>\n<pre><code>var element = null;\nwindow.onscroll = function() {\n    var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;\n    var scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;\n    if (element == null) {\n      element = document.getElementById('scroll-to-top');\n    }\n    if (scrollTop / scrollHeight &gt; 0.1) {\n      element.classList.remove('scroll-to-top-not-display');\n    } else {\n      element.classList.add('scroll-to-top-not-display');\n    }\n}\n</code></pre>\n<p>また、ページを読み込んだ時点ではボタンを表示させないように、<code>scroll-to-top-not-displayed</code> クラスは最初から記述します。</p>\n<pre><code>&lt;a href=&quot;&quot; onclick=&quot;scrollToTop(); return false&quot; id=&quot;scroll-to-top&quot; class=&quot;scroll-to-top-not-display&quot;&gt;トップに戻る&lt;/a&gt;\n</code></pre>\n<h2>CSS：常に前面にボタンを表示させる</h2>\n<p><code>position</code> を固定 <code>fixed</code> し、位置を指定 <code>bottom, right</code> し、<code>z-index</code> を最大値 2147483647 に設定します。そうすれば、スクロールしても位置が変わらないボタンが作成出来ます。</p>\n<pre><code>#scroll-to-top {\n  position: fixed;\n  z-index: 2147483647;\n  bottom: 20px;\n  right: 20px;\n  background: rgba(0,0,0,0.75);\n  color: #fff;\n  font-size: 12px;\n  font-family: sans-serif;\n  text-decoration: none;\n  padding: 10px 10px;\n  border-radius: 2px;\n}\n</code></pre>\n",
  "dir": "static/content/archives",
  "base": "2014-01-09-6431.json",
  "ext": ".json",
  "sourceBase": "2014-01-09-6431.md",
  "sourceExt": ".md"
}